{% extends "polls/base.html" %}
{% block title %}My Profile ¬∑ The Makeup Community{% endblock %}

{% block content %}
<article class="wrap" style="padding-top:24px">
  <!-- Profile Header -->
  <div class="profile-header" style="background: linear-gradient(135deg, #ffffff 0%, #fff5f5 50%, #ffe4e1 100%); border-radius: var(--radius-xl); padding: var(--space-xl); margin-bottom: var(--space-lg); text-align: left; position: relative; overflow: hidden;">
    <!-- Decorative background elements -->
    <div style="position: absolute; top: -20px; right: -20px; width: 100px; height: 100px; background: radial-gradient(circle, rgba(255, 79, 138, 0.1) 0%, transparent 70%); border-radius: 50%; z-index: 0;"></div>
    <div style="position: absolute; bottom: -30px; left: -30px; width: 80px; height: 80px; background: radial-gradient(circle, rgba(255, 127, 178, 0.08) 0%, transparent 70%); border-radius: 50%; z-index: 0;"></div>
    
    <div style="position: relative; z-index: 1;">
      <div style="display: flex; align-items: center; gap: var(--space-lg); margin-bottom: var(--space-lg);">
        <div class="profile-avatar" style="width: 80px; height: 80px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; font-weight: bold; box-shadow: 0 8px 25px rgba(255, 79, 138, 0.3);">
          {{ user.username|first|upper }}
        </div>
        <div style="flex: 1;">
          <h1 style="margin: 0 0 var(--space-xs); font-size: 2rem; background: var(--gradient-primary); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700;">{{ user.username }}</h1>
          <p style="margin: 0; color: var(--muted); font-size: 1rem;">Makeup Enthusiast</p>
          <div style="display: flex; align-items: center; gap: var(--space-sm); margin-top: var(--space-xs);">
            <span style="color: var(--muted); font-size: 0.9rem;">Member since {{ user.date_joined|date:"F Y" }}</span>
            <span style="color: var(--line);">‚Ä¢</span>
            <span style="color: var(--muted); font-size: 0.9rem;">{{ user.email }}</span>
          </div>
        </div>
      </div>
      
      <!-- Profile Stats -->
      <div class="profile-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: var(--space-lg); margin-top: var(--space-lg);">
        <div class="stat-item" style="text-align: center; padding: var(--space-md); background: rgba(255, 255, 255, 0.6); border-radius: var(--radius-lg); border: 1px solid rgba(255, 79, 138, 0.1);">
          <div style="font-size: 2rem; font-weight: bold; color: var(--ink); margin-bottom: var(--space-xs);">{{ total_reviews }}</div>
          <div style="color: var(--muted); font-size: 0.85rem; font-weight: 500;">Reviews Written</div>
        </div>
        <div class="stat-item" style="text-align: center; padding: var(--space-md); background: rgba(255, 255, 255, 0.6); border-radius: var(--radius-lg); border: 1px solid rgba(255, 79, 138, 0.1);">
          <div style="font-size: 2rem; font-weight: bold; color: var(--ink); margin-bottom: var(--space-xs);">{{ average_rating|floatformat:1 }}</div>
          <div style="color: var(--muted); font-size: 0.85rem; font-weight: 500;">Average Rating</div>
        </div>
        <div class="stat-item" style="text-align: center; padding: var(--space-md); background: rgba(255, 255, 255, 0.6); border-radius: var(--radius-lg); border: 1px solid rgba(255, 79, 138, 0.1);">
          <div style="font-size: 2rem; font-weight: bold; color: var(--ink); margin-bottom: var(--space-xs);">2</div>
          <div style="color: var(--muted); font-size: 0.85rem; font-weight: 500;">Badges Earned</div>
        </div>
        <div class="stat-item" style="text-align: center; padding: var(--space-md); background: rgba(255, 255, 255, 0.6); border-radius: var(--radius-lg); border: 1px solid rgba(255, 79, 138, 0.1);">

          <div style="font-size: 2rem; font-weight: bold; color: var(--ink); margin-bottom: var(--space-xs);">#5</div>

          <div style="color: var(--muted); font-size: 0.85rem; font-weight: 500;">Community Rank</div>
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div style="margin-top: var(--space-lg); padding-top: var(--space-lg); border-top: 1px solid rgba(255, 79, 138, 0.1);">
        <div style="display: flex; gap: var(--space-md); flex-wrap: wrap;">
          <a href="{% url 'products' %}" style="background: var(--gradient-primary); color: white; padding: var(--space-sm) var(--space-lg); border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(255, 79, 138, 0.3);">Browse Products</a>
          <a href="{% url 'trends' %}" style="background: rgba(255, 255, 255, 0.8); color: var(--accent); padding: var(--space-sm) var(--space-lg); border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s ease; border: 2px solid var(--accent);">View Trends</a>
          <a href="{% url 'missions' %}" style="background: rgba(255, 255, 255, 0.8); color: var(--accent); padding: var(--space-sm) var(--space-lg); border-radius: 50px; text-decoration: none; font-weight: 600; font-size: 0.9rem; transition: all 0.3s ease; border: 2px solid var(--accent);">Complete Missions</a>
        </div>
      </div>
    </div>
  </div>

    <!-- Badges Section -->
    <section class="badges-section" style="margin-bottom: var(--space-2xl);">
      <h2 style="margin: 0 0 var(--space-lg); font-size: 1.8rem; color: var(--ink);">My Badges</h2>
      <div class="card" style="padding: var(--space-lg);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-md);">
          <div class="badge-card earned" style="border: 1px solid rgba(255, 215, 0, 0.3); border-radius: var(--radius-md); padding: var(--space-md); text-align: center; background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(255, 215, 0, 0.02) 100%);">
            <div style="font-size: 2.5rem; margin-bottom: var(--space-sm);">üèÜ</div>
            <h3 style="margin: 0 0 var(--space-xs); font-size: 1rem;">Foundation Explorer</h3>
            <p style="margin: 0 0 var(--space-sm); color: var(--muted); font-size: 0.85rem;">Reviewed 10 foundations</p>
            <span style="background: #10b981; color: white; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: bold;">Earned</span>
          </div>
          <div class="badge-card earned" style="border: 1px solid rgba(255, 215, 0, 0.3); border-radius: var(--radius-md); padding: var(--space-md); text-align: center; background: linear-gradient(135deg, rgba(255, 215, 0, 0.05) 0%, rgba(255, 215, 0, 0.02) 100%);">
            <div style="font-size: 2.5rem; margin-bottom: var(--space-sm);">üíã</div>
            <h3 style="margin: 0 0 var(--space-xs); font-size: 1rem;">Lipstick Legend</h3>
            <p style="margin: 0 0 var(--space-sm); color: var(--muted); font-size: 0.85rem;">Expert in lip products</p>
            <span style="background: #10b981; color: white; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-size: 0.8rem; font-weight: bold;">Earned</span>
          </div>
          <div class="badge-card locked" style="border: 1px solid var(--line-light); border-radius: var(--radius-md); padding: var(--space-md); text-align: center; opacity: 0.7;">
            <div style="font-size: 2.5rem; margin-bottom: var(--space-sm); filter: grayscale(100%); opacity: 0.5;">‚≠ê</div>
            <h3 style="margin: 0 0 var(--space-xs); font-size: 1rem;">Review Rockstar</h3>
            <p style="margin: 0 0 var(--space-sm); color: var(--muted); font-size: 0.85rem;">Write 50 reviews</p>
            <span style="background: var(--line-light); color: var(--muted); padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); font-size: 0.8rem;">Locked</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section">
      <div style="margin-bottom: var(--space-lg);">
        <h2 style="margin: 0; font-size: 1.8rem; color: var(--ink);">My Reviews</h2>
        <p style="color: var(--muted); margin: var(--space-xs) 0 0;">All the reviews you've written</p>
      </div>
    
    <!-- Reviews List -->
    <div class="reviews-list">
      {% for review in reviews %}
        <div class="review-card card" style="margin: var(--space-md) 0; padding: var(--space-lg); position: relative;">
          <!-- Review Header -->
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: var(--space-md);">
            <div style="flex: 1;">
              <h3 style="margin: 0 0 var(--space-xs); font-size: 1.2rem;">
                <a href="{% url 'product-detail' review.product.pk %}" style="color: var(--ink); text-decoration: none;">
                  {{ review.product.brand }} {{ review.product.name }}
                </a>
              </h3>
              <h4 style="margin: 0 0 var(--space-xs); font-size: 1rem; color: var(--ink-secondary);">{{ review.title }}</h4>
              <div style="display: flex; align-items: center; gap: var(--space-sm); color: var(--muted); font-size: 0.9rem;">
                <div style="display: flex; gap: 2px;">
                  {% for i in "12345" %}
                    <span class="star-rating {% if forloop.counter <= review.rating %}filled{% else %}empty{% endif %}">‚òÖ</span>
                  {% endfor %}
                </div>
                <span>{{ review.rating }}/5</span>
                <span>‚Ä¢</span>
                <span>{{ review.created_at|date:"M d, Y" }}</span>
                {% if review.is_verified_purchase %}
                  <span style="color: var(--gradient-primary); font-weight: 500;">‚úì Verified Purchase</span>
                {% endif %}
              </div>
            </div>
            
            <!-- Review Actions -->
            <div class="review-actions" style="display: flex; gap: var(--space-sm);">
              <a class="btn-link" href="{% url 'review-update' review.pk %}" style="color: var(--ink); padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); background: var(--surface);">Edit</a>
              <a class="btn-link" href="{% url 'review-delete' review.pk %}" style="color: #ff6b6b; padding: var(--space-xs) var(--space-sm); border-radius: var(--radius-sm); background: var(--surface);">Delete</a>
            </div>
          </div>
          
          <!-- Review Body -->
          <div style="color: var(--ink-secondary); line-height: 1.6; margin-bottom: var(--space-md);">
            {{ review.body|linebreaksbr }}
          </div>
          
          <!-- Review Metadata -->
          {% if review.skin_type or review.skin_tone or review.age_range %}
            <div style="display: flex; gap: var(--space-md); margin-bottom: var(--space-md); font-size: 0.8rem; color: var(--muted);">
              {% if review.skin_type %}<span>Skin: {{ review.skin_type|title }}</span>{% endif %}
              {% if review.skin_tone %}<span>Tone: {{ review.skin_tone|title }}</span>{% endif %}
              {% if review.age_range %}<span>Age: {{ review.age_range }}</span>{% endif %}
            </div>
          {% endif %}
          
          <!-- Media -->
          {% if review.media.all %}
            <div style="display: flex; gap: var(--space-sm); margin: var(--space-md) 0; flex-wrap: wrap;">
              {% for media in review.media.all %}
                <a href="{{ media.file.url }}" target="_blank"
                   style="width: 120px; height: 80px; display: block; border: 1px solid var(--line); border-radius: var(--radius-sm); overflow: hidden;">
                  {% if media.kind == 'photo' %}
                    <img src="{{ media.file.url }}" alt="" style="width: 100%; height: 100%; object-fit: cover;">
                  {% else %}
                    <span style="display: grid; place-items: center; width: 100%; height: 100%; color: var(--muted);">Video</span>
                  {% endif %}
                </a>
              {% endfor %}
            </div>
          {% endif %}
          
          <!-- Wear Test -->
          
        </div>
      {% empty %}
        <div class="card" style="padding: var(--space-2xl); text-align: center;">
          <h3 style="margin: 0 0 var(--space-sm); color: var(--muted);">No reviews yet</h3>
          <p style="color: var(--muted); margin: 0 0 var(--space-lg);">Start reviewing products to see them here!</p>
          <a class="primary" href="{% url 'products' %}">Browse Products</a>
        </div>
      {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if is_paginated %}
      <div class="pagination" style="display: flex; justify-content: center; margin-top: var(--space-2xl);">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}" class="btn-outline" style="margin-right: var(--space-sm);">Previous</a>
        {% endif %}
        
        <span style="display: flex; align-items: center; margin: 0 var(--space-md); color: var(--muted);">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}" class="btn-outline" style="margin-left: var(--space-sm);">Next</a>
        {% endif %}
      </div>
    {% endif %}
  </section>
</article>
{% endblock %}

